# 查询报表功能后端接口格式要求

## 1. 接口基础信息

- **基础URL**：`http://localhost:5173/soag/api/`
- **请求/响应格式**：JSON
- **状态码**：200表示成功，非200表示失败

## 2. 接口列表

### 2.1 查询报表列表接口

- **请求方法**：GET
- **URL**：`/inquiries/list`
- **请求参数**：无
- **响应格式**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "inquiries": [
        {
          "id": "string",          // 查询唯一标识
          "name": "string",        // 查询名称
          "query": "string",       // SQL查询语句
          "viewType": "string",    // 视图类型
          "viewOptions": {},        // 视图配置
          "category": "string",    // 报表类别（默认："默认类别"）
          "type": "string",        // 类型（"system"：系统内置，"custom"：自定义）
          "createdAt": "string",   // 创建时间（ISO格式）
          "updatedAt": "string"    // 更新时间（ISO格式）
        }
      ]
    }
  }
  ```

### 2.2 查询报表保存/添加接口

- **请求方法**：POST
- **URL**：`/inquiries/list`
- **请求体**：
  ```json
  {
    "id": "string",          // 查询唯一标识（新增时可选，更新时必填）
    "name": "string",        // 查询名称
    "query": "string",       // SQL查询语句
    "viewType": "string",    // 视图类型
    "viewOptions": {},        // 视图配置
    "category": "string",    // 报表类别（默认："默认类别"）
    "type": "string",        // 类型（默认："custom"）
    "createdAt": "string",   // 创建时间（ISO格式，新增时可选）
    "updatedAt": "string"    // 更新时间（ISO格式，新增时可选）
  }
  ```
- **响应格式**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "inquiry": {
        "id": "string",          // 查询唯一标识
        "name": "string",        // 查询名称
        "query": "string",       // SQL查询语句
        "viewType": "string",    // 视图类型
        "viewOptions": {},        // 视图配置
        "category": "string",    // 报表类别
        "type": "string",        // 类型
        "createdAt": "string",   // 创建时间（ISO格式）
        "updatedAt": "string"    // 更新时间（ISO格式）
      }
    }
  }
  ```

### 2.3 查询报表重命名接口

- **请求方法**：POST
- **URL**：`/inquiries/rename`
- **请求体**：
  ```json
  {
    "inquiryId": "string",    // 查询唯一标识
    "newName": "string"       // 新名称
  }
  ```
- **响应格式**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "inquiry": {
        "id": "string",          // 查询唯一标识
        "name": "string",        // 新名称
        "query": "string",       // SQL查询语句
        "viewType": "string",    // 视图类型
        "viewOptions": {},        // 视图配置
        "category": "string",    // 报表类别
        "type": "string",        // 类型
        "createdAt": "string",   // 创建时间（ISO格式）
        "updatedAt": "string"    // 更新时间（ISO格式）
      }
    }
  }
  ```

### 2.4 查询报表删除接口

- **请求方法**：DELETE
- **URL**：`/inquiries/delete`
- **请求体**：
  ```json
  {
    "inquiryIds": ["string"]    // 查询唯一标识列表
  }
  ```
- **响应格式**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "deletedCount": 1    // 删除成功的数量
    }
  }
  ```

### 2.5 查询报表复制接口

- **请求方法**：POST
- **URL**：`/inquiries/copy`
- **请求体**：
  ```json
  {
    "inquiryId": "string"    // 查询唯一标识
  }
  ```
- **响应格式**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "inquiry": {
        "id": "string",          // 新查询唯一标识
        "name": "string",        // 新名称（原名称 + " Copy"）
        "query": "string",       // SQL查询语句（与原查询相同）
        "viewType": "string",    // 视图类型（与原查询相同）
        "viewOptions": {},        // 视图配置（与原查询相同）
        "category": "string",    // 报表类别（与原查询相同）
        "type": "string",        // 类型（默认："custom"）
        "createdAt": "string",   // 创建时间（ISO格式）
        "updatedAt": "string"    // 更新时间（ISO格式）
      }
    }
  }
  ```

### 2.6 查询报表导出接口

- **请求方法**：POST
- **URL**：`/inquiries/export`
- **请求体**：
  ```json
  {
    "inquiryIds": ["string"]    // 查询唯一标识列表
  }
  ```
- **响应格式**：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "fileUrl": "string"    // 导出文件的下载URL
    }
  }
  ```

## 3. 数据结构说明

### 3.1 查询对象字段说明

| 字段名 | 类型 | 说明 | 示例值 |
| --- | --- | --- | --- |
| id | string | 查询唯一标识 | "123e4567-e89b-12d3-a456-426614174000" |
| name | string | 查询名称 | "销售报表" |
| query | string | SQL查询语句 | "SELECT * FROM sales" |
| viewType | string | 视图类型 | "table" |
| viewOptions | object | 视图配置 | {"columns": ["name", "amount"]} |
| category | string | 报表类别 | "销售报表" |
| type | string | 类型 | "system" 或 "custom" |
| createdAt | string | 创建时间 | "2023-01-01T00:00:00.000Z" |
| updatedAt | string | 更新时间 | "2023-01-01T00:00:00.000Z" |

### 3.2 类型说明

- **system**：系统内置查询，不允许修改和删除
- **custom**：用户自定义查询，允许修改和删除

## 4. 前端改造说明

### 4.1 表格字段变化

| 原字段 | 新字段 | 说明 |
| --- | --- | --- |
| 名称 | 名称 | 保持不变 |
| 创建时间 | 报表类别 | 新增字段，默认为"默认类别" |
| - | 类型 | 新增字段，区分系统内置和自定义 |
| 创建时间 | 创建时间 | 格式改为yyyy-MM-dd HH:mm:ss |
| - | 操作 | 新增字段，包含修改、复制、导出、删除按钮 |

### 4.2 操作按钮变化

- **修改**：仅自定义类型显示，图标+文字，蓝色可点击
- **复制**：所有类型显示，图标+文字，蓝色可点击
- **导出**：所有类型显示，图标+文字，蓝色可点击
- **删除**：仅自定义类型显示，图标+文字，蓝色可点击

## 5. 示例请求和响应

### 5.1 查询报表列表示例

**请求**：
```
GET /soag/api/inquiries/list
```

**响应**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "inquiries": [
      {
        "id": "123e4567-e89b-12d3-a456-426614174000",
        "name": "销售报表",
        "query": "SELECT * FROM sales",
        "viewType": "table",
        "viewOptions": {"columns": ["name", "amount"]},
        "category": "销售报表",
        "type": "system",
        "createdAt": "2023-01-01T00:00:00.000Z",
        "updatedAt": "2023-01-01T00:00:00.000Z"
      },
      {
        "id": "234e5678-f90c-23e4-b567-537725285111",
        "name": "用户报表",
        "query": "SELECT * FROM users",
        "viewType": "chart",
        "viewOptions": {"chartType": "bar"},
        "category": "用户报表",
        "type": "custom",
        "createdAt": "2023-01-02T12:00:00.000Z",
        "updatedAt": "2023-01-02T12:00:00.000Z"
      }
    ]
  }
}
```

## 6. 注意事项

1. 所有接口返回的时间格式必须为ISO格式，前端会将其转换为yyyy-MM-dd HH:mm:ss格式显示
2. 系统内置查询（type=system）不允许修改和删除，后端需要在接口中进行校验
3. 接口响应必须包含code、message和data字段
4. 错误响应格式统一为：
   ```json
   {
     "code": 错误码,
     "message": "错误信息",
     "data": null
   }
   ```
5. 导出接口返回的fileUrl必须是可直接访问的下载链接

## 7. 兼容性考虑

前端改造后，支持向后兼容，当后端接口不可用时，会降级使用本地存储（localStorage）。
